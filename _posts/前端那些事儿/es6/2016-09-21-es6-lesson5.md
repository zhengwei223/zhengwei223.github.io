---
layout: post
title: ES6(ES2015)-lesson5
category: es6
tags: es6 es2015
author: 郑未
keywords: lanqiao 蓝桥 培训 教程 前端 es6 es2015
p_cate: 前端那些事儿
description: 这一章主要讲解es6提供的迭代器和for-of语法，这些新特性将极大简化迭代那些事儿
---
>内容提要

- 回顾各种迭代方式
- for-of语法
- 迭代器

# 各种迭代

[lesson5-1.js](https://coding.net/u/lanqiao/p/frontAdvance/git/blob/master/es6/lesson5-1.js)

## 原始的数组

    for (var index = 0; index < myArray.length; index++) {
      console.log(myArray[index]);
    }

## forEach方法

    myArray.forEach(function (value) {
    console.log(value);
    });

这段代码看起来更加简洁，但这种方法也有一个小缺陷：你不能使用break语句中断循环，也不能使用return语句返回到外层函数。

## for-in循环：

    for (var index in myArray) { // 千万别这样做
      console.log(myArray[index]);
    }

这绝对是一个糟糕的选择，为什么呢？

- 在这段代码中，赋给index的值不是实际的数字，而是字符串“0”、“1”、“2”，此时很可能在无意之间进行字符串算数计算，例如：“2” + 1 == “21”，这给编码过程带来极大的不便。
- 作用于数组的for-in循环体除了遍历数组元素外，还会遍历自定义属性。举个例子，如果你的数组中有一个可枚举属性myArray.name，循环将额外执行一次，遍历到名为“name”的索引。就连数组原型链上的属性都能被访问到。
- 最让人震惊的是，在某些情况下，这段代码可能按照随机顺序遍历数组元素。
- 简而言之，for-in是为普通对象设计的，你可以遍历得到字符串类型的键，因此不适用于数组遍历。

# for-of循环

## 遍历数组

就像这样：


    for (var value of myArray) {
      console.log(value);
    }

## 遍历其它的集合

### 字符串

    for (var chr of "") {
      alert(chr);
    }

### Map和Set对象

Map和Set是ES6中新增的类型。我们将在[lesson8](/es6/es6-lesson8)讲解这两个新的类型。
这里了解下遍历的用法即可。

Set：

    var words = ['hello','hi','hello','bye','byebye','goodbye'];
    // 基于单词数组创建一个set对象
    var uniqueWords = new Set(words);
    for (var word of uniqueWords) {
       console.log(word);
    }
    /*~  自动去掉重复项 
    hello
    hi
    bye
    byebye
    goodbye
    ~*/

Map：

    var phoneBookMap = new Map([['zhangsan','130...'],['lisi','131...'],['wangwu','132...']]);
    for (let [key, value] of phoneBookMap) {
       console.log(key + "'s phone number is: " + value);
    }
    /*~
    zhangsan's phone number is: 130...
    lisi's phone number is: 131...
    wangwu's phone number is: 132...
    ~*/

遍历Map时，我们用到了解构赋值的语法。

## 普通对象

for-of循环不支持普通对象，但如果你想迭代一个对象的属性，你可以用for-in循环（这也是它的本职工作）或内建的Object.keys()方法：

    // 向控制台输出对象的可枚举属性
    for (var key of Object.keys(someObject)) {
      console.log(key + ": " + someObject[key]);
    }

# 迭代器

[lesson5-2.js](https://coding.net/u/lanqiao/p/frontAdvance/git/blob/master/es6/lesson5-2.js)

for-of循环首先调用目标集合对象的`[Symbol.iterator]`方法，该方法返回一个迭代器对象——任意具有.next()方法的对象；

**注：对象的Symbol.iterator属性，指向该对象的默认遍历器方法，即该对象进行for...of循环时，会调用这个方法，返回该对象的默认遍历器，关于Symbol的讲解在[lesson9](/es6/es6-lesson9)**

for-of循环将重复调用这个方法，每次循环调用一次。    

    let fibonacci = {
      [Symbol.iterator]() {  //[Symbol.iterator]是函数名，注意该函数的return语句
        let pre = 0, cur = 1;
        return {                        //返回迭代器对象，拥有next方法
          next() {
            [pre, cur] = [cur, pre + cur];    //解构赋值语法
            return { done: false, value: cur }  //next方法返回{done:true|false,value:当前值}
          }
        }
      }
    };
    for (var n of fibonacci) {
      // truncate the sequence at 10
      if (n > 10)
        break;
      console.log(n);
    }

`Symbol`是JavaScript的第七种原始类型，以后再详细解释。    