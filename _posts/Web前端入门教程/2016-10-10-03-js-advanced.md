---
layout: post
title: 网页JavaScript高级应用
category: Web前端入门教程
tags: Web前端
description: 本小节主要介绍如何使用JavaScript正则表达式在表单验证中的验证。此外，还会讲解用纯文本保存JavaScript对象的数据格式JSON。
author: 曹小虎
keywords: lanqiao 蓝桥 全栈 教程 Web前端
---

> 本章目标

- 学习JavaScript标准库对象正则表达式
- 用正则表达式完成Form表单输入校验
- 掌握使用JSON数据格式存储和传输JS对象的方法


# 实验一：过滤出字符串里的数字

目的：

1. 掌握如何创建正则表达式
2. 掌握正则表达式的过滤字符串的方法
3. 掌握如何编写正则表达式

&emsp;&emsp;正则表达式是JavaScript标准库支持的一种对象类型，它的主要用途是用来匹配字符串中的特定内容。

## 1.1 定义页面内容

### 定义页面控件

&emsp;&emsp;在空白页面的内容区定义了一个单行文本框、一个按钮、一个多行文本框，代码如下：

    <!--网页内容区开始-->
    <input type="text" id="txtBox" style="width:250px;" />
    <br/><br/>
    <!-- 按钮的onclick属性定义了用户点击按钮时应该调用哪个函数 -->
    <input type="button" value="过滤出数字" style="width:250px;" onclick="processString();"/>
    <br/><br/>
    <!-- 我们会把过滤出来的数字拼接在多行文本框里面 -->
    <textarea id="txtArea" rows="6" cols="30" style="width:250px;">
    </textarea> 
    <!--网页内容区结束-->

&emsp;&emsp;完成之后打开浏览器可以看到：

 ![js_regexp_tutorial_filter_number](/public/img/js/js_regexp_tutorial_filter_number.png)

## 1.2 编写JavaScript函数

### 定义processString函数

&emsp;&emsp;在页面内容区的尾部追加下面的JS脚本定义：

    <script type="text/javascript">
     function processString(){
      //获得当行文本框内容
      var inputString = document.getElementById("txtBox").value;
      /* 在此处使用正则表达式处理字符串  */
      var  result = inputString;
      if(result != null){
        var text ="";
        for(var i=0;i<result.length;i++){
	      text += result[i] + "\r\n";//每追加一个数字进行一次回车和换行操作
	    }
	    document.getElementById("txtArea").value = text; 
      }

     }
    </script>

### 过滤第一个数字

&emsp;&emsp;找到JS示例代码中的第6行，把它替换成下面的内容：

    /*
     1.调用字符串对象的“match”函数
     2.把一个正则表达式的字面量作为参数传入
     3.我们打算把字符串里面的数字过滤出来，d就是digit的意思
     */
    var  result = inputString.match(/\d/);

&emsp;&emsp;在页面上输入内容，测试过滤效果：

 ![js_regexp_tutorial_filter_number_02](/public/img/js/js_regexp_tutorial_filter_number_02.gif)

### 过滤全部数字

&emsp;&emsp;为了把字符串里面所有符合条件的内容都匹配出来，我们需要给正则表达式的字面量一个全局匹配的标识。

&emsp;&emsp;找到JS示例代码中的第6行，把它替换成下面的内容：

    /*
     1.调用字符串对象的“match”函数
     2.把一个正则表达式的字面量作为参数传入
     3.我们打算把字符串里面的数字过滤出来，d就是digit的意思
     */
    var  result = inputString.match(/\d/g);

 ![js_regexp_tutorial_filter_number_03](/public/img/js/js_regexp_tutorial_filter_number_03.gif)

### 正确地显示数字

&emsp;&emsp;显然，“2017”在一起才表达一个完整的意义，其他表示月份和日期的数字也是这样。想要在正则表达式里面实现这个，就要再次改写传入“match”函数的正则表达式字面量。

&emsp;&emsp;找到JS示例代码中的第6行，把它替换成下面的内容：

    /*
     1.调用字符串对象的“match”函数
     2.把一个正则表达式的字面量作为参数传入
     3.我们打算把字符串里面的数字过滤出来，d就是digit的意思
     */
    var  result = inputString.match(/\d+/g);

&emsp;&emsp;刷新页面重新测试，可以看到：

 ![js_regexp_tutorial_filter_number_04](/public/img/js/js_regexp_tutorial_filter_number_04.gif)


# 实验一的解读

## 如何创建正则表达式

### 从字面量创建

&emsp;&emsp;从使用正则表达式字面量的语法可以快速创建对象，这是因为JS引擎会暗中把符合语法规则的字面量解释成一个对象。

    /* 使用控制台时间工具检查创建对象花费多少时间  */
    console.time('用字面量语法创建正则表达式');
    var re = /\d+/g;
    console.timeEnd('用字面量语法创建正则表达式');

&emsp;&emsp;在控制台输入以上代码，回车确认执行，可以看到：

 ![js_regexp_tutorial_demo_01](/public/img/js/js_regexp_tutorial_filter_number_05.gif)

&emsp;&emsp;控制台时间工具显示创建和声明这个变量花费了0.042毫秒。从变量“re”查看它的构造函数、尝试调用到输入正则表达式类型对象的各种方法的结构，都表明：这是一个货真价实的正则表达式对象。

&emsp;&emsp;

### 字面量语法特征

&emsp;&emsp;正则表达式的字面量语法需要分别以一个斜杠“/”开头和结尾，两个斜杠之间的字符串内容就是正则表达式模式（pattern），描述了字符串匹配模式。

> a sequence of character that form a search pattern

&emsp;&emsp;位于字面量表达式结尾处的斜杠之后，可以关联一个或者多个正则表达式的标志。例如，在实验一里用于过滤数字的正则表达式字面量里面就关联了一个“g”字母，表示我们希望匹配出字符里面的全部数字——全局匹配。

 ![js_regexp_tutorial_filter_number_08](/public/img/js/js_regexp_tutorial_filter_number_08.png)

&emsp;&emsp;正则表达式字面量的末尾还可以关联另外两种标志：

- i&emsp;让正则表达式在匹配英文字母的时候不区分大小写，例如/test/i不仅可以匹配 字符串“test” ,还可以匹配 “Test” “TEST” “tEsT” 等字符串
- m&emsp;允许匹配多个行,比如可以匹配文本区元素(textarea)中的字


&emsp;&emsp;从控制台我们还可以看出：如果不关联标志“i”，那么正则表达式re的ignoreCase属性值为false；如果不关联标志“m”，那么正则表达式re的multiline属性值也为“false”。

### 使用构造函数

&emsp;&emsp;用构造函数创建正则表达式类型对象也是一种可选的方法：

    /* 使用控制台时间工具检查创建对象花费多少时间  */
    console.time('用构造函数创建正则表达式');
    var re1 = new RegExp("\\d+",'g');
    console.timeEnd('用构造函数创建正则表达式');

&emsp;&emsp;在控制台输入以上代码，回车确认执行，可以看到：

 ![js_regexp_tutorial_filter_number_06](/public/img/js/js_regexp_tutorial_filter_number_06.gif)

&emsp;&emsp;从控制台的输出结果可以看出，这种方法创建的正则表达式对象与用字面量语法的方法没有区别。唯一的区别是：它们花费的时间有些不同，后者比前者稍微慢了一点。

&emsp;&emsp;请问：这件事是偶然的吗？

&emsp;&emsp;

### 正则表达式构造函数的参数

&emsp;&emsp;用构造函数创建正则表达式对象，一共需要向构造函数传入两个字符串类型的参数。第一个字符串正则表达式模式（pattern）的内容，第二个字符串就是与该正则表达式关联的标志位。

&emsp;&emsp;在开发过程中,如果正则是已知的,则优先选择字面量语法,而构造器方式则是用于在运行时,通过动态创建字符串来构建正则表达式.

&emsp;&emsp;

## 如何使用正则表达式

&emsp;&emsp;除了实验一我们演示过的，通过String类型对象的match函数使用正则表达式过滤字符串。
### String对象中的方法

&emsp;&emsp;可以使用正则表达式的String类型对象方法除了match以外，还有下面几个方法：

<table style="border:1px solid;border-collapse: collapse;">
<tr>
<th>方法</th>
<th>含义</th>
</tr>
<tr>
<td>match(pattern)</td>
<td>返回 pattern 中的子串或 null</td>
</tr>
<tr>
<td>replace(pattern, replacement)</td>
<td>用 replacement 替换 pattern</td>
</tr>
<tr>
<td>search(pattern)</td>
<td>返回字符串中 pattern 开始位置</td>
</tr>
<tr>
<td>split(pattern)</td>
<td>返回字符串按指定 pattern 拆分的数组</td>
</tr>
</table>

&emsp;&emsp;关于这些方法的详情，请打开链接参考[MDN String.prototype](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/prototype)页面。


### 使用由字面量语法定义的正则表达式对象

 ![js_regexp_tutorial_filter_number_07](/public/img/js/js_regexp_tutorial_filter_number_07.gif)

### 使用由构造函数创建的正则表达式对象

 ![js_regexp_tutorial_filter_number_09](/public/img/js/js_regexp_tutorial_filter_number_09.gif)

&emsp;&emsp;有关JavaScript标准库的正则表达式（RegExp）对象的权威信息，请大家参考[MDN JavaScript正则表达式](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions)页面。

&emsp;&emsp;

&emsp;&emsp;

# 实验二:用正则表达式验证表单输入

目的：
1. 自定义正则表达式进行表单输入数据校验
2. 在校验表单输入时使用第三方JS插件

# 实验二的解读

&emsp;&emsp;

&emsp;&emsp;

# 实验三：文本里的JS对象——使用JSON格式数据

&emsp;&emsp;本实验将要用到一个公开在万维网上的JSON数据服务：

>[http://services.groupkt.com/country/get/iso2code/CN](http://services.groupkt.com/country/get/iso2code/CN)。

目的：

1. 在页面上展示JSON格式数据
2. 编制自己的JSON格式数据

## 3.1 制作消费JSON数据的网页

### 在本地查看JSON数据格式

&emsp;&emsp;你只需要在http地址的字符串末尾输入代表其他国家名称的两位ISO标准编码，就可以得到一个记录了该国完整名称的JSON格式数据。

 ![js_data_inter_change_json_01](/public/img/js/js_data_inter_change_json_01.gif)

&emsp;&emsp;把页面返回的JSON格式数据复制下来，在文本编辑器里面另存为后缀名是“.json”的文件。

 ![js_data_inter_change_json_02](/public/img/js/js_data_inter_change_json_02.gif)

### 从网上获取JSON格式数据

&emsp;&emsp;新建一个空白HTML文件，用于演示JSON格式数据的转换。

 ![js_data_inter_change_json_03](/public/img/js/js_data_inter_change_json_03.gif)

&emsp;&emsp;然后在网页头部加入以下JavaScript脚本：

    var getJSON = function(url, successHandler, errorHandler) {
	    var xhr = typeof XMLHttpRequest != 'undefined'
		    ? new XMLHttpRequest()
		    : new ActiveXObject('Microsoft.XMLHTTP');
	    xhr.open('get', url, true);
	    xhr.onreadystatechange = function() {
		    var status;
		    var data;
		    if (xhr.readyState == 4) { // `DONE`
			status = xhr.status;
            /* 状态码是200表明发出的服务器响应就绪,
               可以从xhr对象获取服务器返回的文本文字了 */
			if (status == 200) {
			    var responseText = xhr.responseText;
                //调用successHandler函数
				successHandler && successHandler(responseText);
			} else {
				errorHandler && errorHandler(status);
			}
		}
	};
	    xhr.send();
    };

    /* 
       在不影响当前窗口地址、刷新页面的情况下
       向指定万维网地址发送请求，读取返回结果
     */
        getJSON('http://services.groupkt.com/country/get/iso2code/CN', function(responseText) {
	        console.log('从服务器返回的内容是：' + responseText);
            console.log('reponseText的变量类型是：' + typeof(responseText));  
        }, function(status) {
	        console.log('发生错误，状态代码是：'+status);
        });

&emsp;&emsp;刷新页面以后在控制台输出服务器返回的数据格式：

 ![js_data_inter_change_json_04](/public/img/js/js_data_inter_change_json_04.gif)

&emsp;&emsp;经过对比，控制上显示的内容如之前在本地保存的“data.json”文件内容完全一致。

### 用JS语言展示数据

&emsp;&emsp;接下来我们把从万维网上直接获取的JSON数据格式的字符串装换成JS对象。

&emsp;&emsp;在*getJSON*方法里面加入一下代码：

    var responseObj = eval("("+responseText+")");
    console.log('使用eval函数之后的结果是：' + typeof(responseObj));
    console.table(responseObj);

&emsp;&emsp;重新刷新页面，检查控制台可以看到：

 ![js_data_inter_change_json_05](/public/img/js/js_data_inter_change_json_05.gif)

## 3.2 生产自己的JSON数据

### 使用文本编辑器

&emsp;&emsp;由在本地保存json文件的过程我们可以得知：JSON数据格式本质上是一个纯文本文件。因此，用文本编辑器就可以直接制作json数据（格式）的文件。

&emsp;&emsp;我们来创建一个记录个人基本信息的JSON数据格式开始：

     /* 
        name(string)  : value（string、number、boolean、object、array...）
     */
    {
        "name"        : "韦小宝",
        "gender"      : "男",
        "nationality" : "汉",
        "age"         :  16,
        "occupation"  :  "宫廷摔跤队头目",
        "isNew"       :  true,
        "hobbies"     :  ["吹牛","打架","赌博"],
        "address"     :  { 
                            "city"     : "北京市",
                            "district" : "东城区",
                            "street"   : "景山前街4号",
                            "house"    : "紫禁城敬事房",
                         }
    }

&emsp;&emsp;新建一个后缀名是“.json”的文本文件，保存以上内容。

 ![js_data_inter_change_json_06](/public/img/js/js_data_inter_change_json_06.gif)

&emsp;&emsp;打开[jsonlint](http://jsonlint.com/)网站页面，在文本框里输入以上内容，验证JSON格式是否合法：

 ![js_data_inter_change_json_07](/public/img/js/js_data_inter_change_json_07.gif)
   
### 使用JS语法

&emsp;&emsp;如果在Chrome DevTools控制台上用一个变量保存上述json数据内容，那么就相当于直接声明、创建了一个JS对象：

    var weixiaobao = {
         /* 此处省略json内容若干行......  */
    };

 ![js_data_inter_change_json_08](/public/img/js/js_data_inter_change_json_08.gif)

&emsp;&emsp;

&emsp;&emsp;

# 实验三的解读

&emsp;&emsp;本次实验主要演示了一种万维网上被广泛应用的数据传输格式。

## JSON基础

### 什么是JSON格式的数据

&emsp;&emsp;究竟什么是JSON？

- JSON的全称是JavaScript Object Notation，就是JavaScript对象符号
- JSON的语法规则源出自JS对象字面量，但是只包含纯文本
- 任何一种编程语言都可以依照JSON格式生成纯文本数据内容，同样也能读懂这样的数据

### 基本语法

&emsp;&emsp;实验三，我们做的第一件事就是从万维网上的一个公共数据服务获取JSON格式数据的内容，然后据此在本地创建“.json”的纯文本文件。

&emsp;&emsp;Notepad++这个文本编辑器为json格式的数据文件提供了语法支持，我们可以很方便的查看到json格式的内部层次结构。再结合我们自己创建JSON格式数据的过程，可以总结出，json格式的数据有以下几大特征：

- 数据内容以name/value成对出现
- 多条数据内容以逗号分隔
- 成对的花括号加上两者之间的数据内容，组成完整的JSON对象
- name必须以字符串出现，value可以是字符串、数字、布尔值、数组或者其他对象
- JSON数组的写法与JS数组字面量的写法近似，但是JSON数组内部只能包含第四条里面提到的几种类型的value值

 ![basic_json_object_syntax](/public/img/js/basic_json_object_syntax.png)

&emsp;&emsp;有兴趣了解JSON发展历史的同学请移步[维基百科 JSON](https://zh.wikipedia.org/wiki/JSON)主页。

&emsp;&emsp;有兴趣了解W3School如何介绍JSON数据格式的同学，请移步[W3School JSON教程](http://www.w3school.com.cn/json/)页面。


## 应用

&emsp;&emsp;JSON是一种轻量级的数据存储格式和数据传输格式。

### “.json”文件

&emsp;&emsp;我们在实验三一共创建了两个json文件，这样的json文件就可以被用来保存数据。

 ![js_data_inter_change_json_08](/public/img/js/json_file_logo.png){:width="200px" height="300px"}

&emsp;&emsp;现在有很多应用于Web前端的JavaScript类库都把“.json”文件作为配置文件的首选格式，看中的就是JSON具有良好的可读和便于快速编写的特性。

### JS标准库的eval函数

&emsp;&emsp;JSON最常用的另外一个场景是从服务器向网页传输数据。

&emsp;&emsp;在实验三里面，我们的定义了一个getJSON方法从一个提供数据的万维网服务那里获取了一个JSON格式的长字符串，然后又调用*eval*方法，这个字符串转化为JavaScript对象。

&emsp;&emsp;这是现在很多网页应用的常用做法。下面的图片完整地解释了JSON格式数据在网站中的应用方法：

 ![JSON_ClientToServer](/public/img/js/JSON_ClientToServer.png)

&emsp;&emsp;很显然，“eval”这个函数名就是源自于英文单词“evaluate”。下面是商务印书馆出版的一本《牛津高级英汉词典》对这个单词的解释：

> evaluate : to form an opinion of the amount, value or quality of something after thinking about it carefully

&emsp;&emsp;有关*eval*函数的详细资料，大家可以参考[MDN JavaScript标准库 eval()](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/eval)页面。

### JS标准库的JSON工具对象

&emsp;&emsp;JavaScript标准库还提供了一个处理JSON格式数据的工具：JSON对象。

&emsp;&emsp;[JSON.parse()](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse)函数可以把JSON字符串转化为JS对象。

&emsp;&emsp;[JSON.stringify()](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify)的作用是把JS对象转换成JSON字符串。

 ![js_data_inter_change_json_09](/public/img/js/js_data_inter_change_json_09.gif)

&emsp;&emsp;请大家自行了解、尝试。
