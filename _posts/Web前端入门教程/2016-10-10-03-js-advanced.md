---
layout: post
title: 网页JavaScript高级应用
category: Web前端入门教程
tags: Web前端
description: 本小节主要介绍如何使用JavaScript正则表达式在表单验证中的验证。此外，还会讲解用纯文本保存JavaScript对象的数据格式JSON。
author: 曹小虎
keywords: lanqiao 蓝桥 全栈 教程 Web前端
---

> 本章目标

- 学习JavaScript标准库对象正则表达式
- 用正则表达式完成Form表单输入校验
- 掌握使用JSON数据格式存储和传输JS对象的方法


# 实验一：过滤出字符串里的数字

目的：

1. 掌握如何创建正则表达式
2. 掌握正则表达式的过滤字符串的方法
3. 掌握如何编写正则表达式

&emsp;&emsp;正则表达式是JavaScript标准库支持的一种对象类型，它的主要用途是用来匹配字符串中的特定内容。

## 1.1 定义页面内容

### 定义页面控件

&emsp;&emsp;在空白页面的内容区定义了一个单行文本框、一个按钮、一个多行文本框，代码如下：

    <!--网页内容区开始-->
    <input type="text" id="txtBox" style="width:250px;" />
    <br/><br/>
    <!-- 按钮的onclick属性定义了用户点击按钮时应该调用哪个函数 -->
    <input type="button" value="过滤出数字" style="width:250px;" onclick="processString();"/>
    <br/><br/>
    <!-- 我们会把过滤出来的数字拼接在多行文本框里面 -->
    <textarea id="txtArea" rows="6" cols="30" style="width:250px;">
    </textarea> 
    <!--网页内容区结束-->

&emsp;&emsp;完成之后打开浏览器可以看到：

 ![js_regexp_tutorial_filter_number](/public/img/js/js_regexp_tutorial_filter_number.png)

## 1.2 编写JavaScript函数

### 定义processString函数

&emsp;&emsp;在页面内容区的尾部追加下面的JS脚本定义：

    <script type="text/javascript">
     function processString(){
      //获得当行文本框内容
      var inputString = document.getElementById("txtBox").value;
      /* 在此处使用正则表达式处理字符串  */
      var  result = inputString;
      if(result != null){
        var text ="";
        for(var i=0;i<result.length;i++){
	      text += result[i] + "\r\n";//每追加一个数字进行一次回车和换行操作
	    }
	    document.getElementById("txtArea").value = text; 
      }

     }
    </script>

### 过滤第一个数字

&emsp;&emsp;找到JS示例代码中的第6行，把它替换成下面的内容：

    /*
     1.调用字符串对象的“match”函数
     2.把一个正则表达式的字面量作为参数传入
     3.我们打算把字符串里面的数字过滤出来，d就是digit的意思
     */
    var  result = inputString.match(/\d/);

&emsp;&emsp;在页面上输入内容，测试过滤效果：

 ![js_regexp_tutorial_filter_number_02](/public/img/js/js_regexp_tutorial_filter_number_02.gif)

### 过滤全部数字

&emsp;&emsp;为了把字符串里面所有符合条件的内容都匹配出来，我们需要给正则表达式的字面量一个全局匹配的标识。

&emsp;&emsp;找到JS示例代码中的第6行，把它替换成下面的内容：

    /*
     1.调用字符串对象的“match”函数
     2.把一个正则表达式的字面量作为参数传入
     3.我们打算把字符串里面的数字过滤出来，d就是digit的意思
     */
    var  result = inputString.match(/\d/g);

 ![js_regexp_tutorial_filter_number_03](/public/img/js/js_regexp_tutorial_filter_number_03.gif)

### 正确地显示数字

&emsp;&emsp;显然，“2017”在一起才表达一个完整的意义，其他表示月份和日期的数字也是这样。想要在正则表达式里面实现这个，就要再次改写传入“match”函数的正则表达式字面量。

&emsp;&emsp;找到JS示例代码中的第6行，把它替换成下面的内容：

    /*
     1.调用字符串对象的“match”函数
     2.把一个正则表达式的字面量作为参数传入
     3.我们打算把字符串里面的数字过滤出来，d就是digit的意思
     */
    var  result = inputString.match(/\d+/g);

&emsp;&emsp;刷新页面重新测试，可以看到：

 ![js_regexp_tutorial_filter_number_04](/public/img/js/js_regexp_tutorial_filter_number_04.gif)


# 实验一的解读

## 如何创建正则表达式

### 从字面量创建

&emsp;&emsp;从使用正则表达式字面量的语法可以快速创建对象，这是因为JS引擎会暗中把符合语法规则的字面量解释成一个对象。

    /* 使用控制台时间工具检查创建对象花费多少时间  */
    console.time('用字面量语法创建正则表达式');
    var re = /\d+/g;
    console.timeEnd('用字面量语法创建正则表达式');

&emsp;&emsp;在控制台输入以上代码，回车确认执行，可以看到：

 ![js_regexp_tutorial_demo_01](/public/img/js/js_regexp_tutorial_filter_number_05.gif)

&emsp;&emsp;控制台时间工具显示创建和声明这个变量花费了0.042毫秒。从变量“re”查看它的构造函数、尝试调用到输入正则表达式类型对象的各种方法的结构，都表明：这是一个货真价实的正则表达式对象。

&emsp;&emsp;

### 字面量语法特征

&emsp;&emsp;正则表达式的字面量语法需要分别以一个斜杠“/”开头和结尾，两个斜杠之间的字符串内容就是正则表达式模式（pattern），描述了字符串匹配模式。

> a sequence of character that form a search pattern

&emsp;&emsp;位于字面量表达式结尾处的斜杠之后，可以关联一个或者多个正则表达式的标志。例如，在实验一里用于过滤数字的正则表达式字面量里面就关联了一个“g”字母，表示我们希望匹配出字符里面的全部数字——全局匹配。

 ![js_regexp_tutorial_filter_number_08](/public/img/js/js_regexp_tutorial_filter_number_08.png)

&emsp;&emsp;正则表达式字面量的末尾还可以关联另外两种标志：

- i&emsp;让正则表达式在匹配英文字母的时候不区分大小写，例如/test/i不仅可以匹配 字符串“test” ,还可以匹配 “Test” “TEST” “tEsT” 等字符串
- m&emsp;允许匹配多个行,比如可以匹配文本区元素(textarea)中的字


&emsp;&emsp;从控制台我们还可以看出：如果不关联标志“i”，那么正则表达式re的ignoreCase属性值为false；如果不关联标志“m”，那么正则表达式re的multiline属性值也为“false”。

### 使用构造函数

&emsp;&emsp;用构造函数创建正则表达式类型对象也是一种可选的方法：

    /* 使用控制台时间工具检查创建对象花费多少时间  */
    console.time('用构造函数创建正则表达式');
    var re1 = new RegExp("\\d+",'g');
    console.timeEnd('用构造函数创建正则表达式');

&emsp;&emsp;在控制台输入以上代码，回车确认执行，可以看到：

 ![js_regexp_tutorial_filter_number_06](/public/img/js/js_regexp_tutorial_filter_number_06.gif)

&emsp;&emsp;从控制台的输出结果可以看出，这种方法创建的正则表达式对象与用字面量语法的方法没有区别。唯一的区别是：它们花费的时间有些不同，后者比前者稍微慢了一点。

&emsp;&emsp;请问：这件事是偶然的吗？

&emsp;&emsp;

### 正则表达式构造函数的参数

&emsp;&emsp;用构造函数创建正则表达式对象，一共需要向构造函数传入两个字符串类型的参数。第一个字符串正则表达式模式（pattern）的内容，第二个字符串就是与该正则表达式关联的标志位。

&emsp;&emsp;在开发过程中,如果正则是已知的,则优先选择字面量语法,而构造器方式则是用于在运行时,通过动态创建字符串来构建正则表达式.

&emsp;&emsp;

## 如何使用正则表达式

&emsp;&emsp;除了实验一我们演示过的，通过String类型对象的match函数使用正则表达式过滤字符串。
### String对象中的方法

&emsp;&emsp;可以使用正则表达式的String类型对象方法除了match以外，还有下面几个方法：

<table style="border:1px solid;border-collapse: collapse;">
<tr>
<th>方法</th>
<th>含义</th>
</tr>
<tr>
<td>match(pattern)</td>
<td>返回 pattern 中的子串或 null</td>
</tr>
<tr>
<td>replace(pattern, replacement)</td>
<td>用 replacement 替换 pattern</td>
</tr>
<tr>
<td>search(pattern)</td>
<td>返回字符串中 pattern 开始位置</td>
</tr>
<tr>
<td>split(pattern)</td>
<td>返回字符串按指定 pattern 拆分的数组</td>
</tr>
</table>

&emsp;&emsp;关于这些方法的详情，请打开链接参考[MDN String.prototype](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/prototype)页面。


### 使用由字面量语法定义的正则表达式对象

 ![js_regexp_tutorial_filter_number_07](/public/img/js/js_regexp_tutorial_filter_number_07.gif)

### 使用由构造函数创建的正则表达式对象

 ![js_regexp_tutorial_filter_number_09](/public/img/js/js_regexp_tutorial_filter_number_09.gif)

&emsp;&emsp;有关JavaScript标准库的正则表达式（RegExp）对象的权威信息，请大家参考[MDN JavaScript正则表达式](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions)页面。

&emsp;&emsp;

&emsp;&emsp;

# 实验二:用正则表达式验证表单输入

目的：
1. 自定义正则表达式进行表单输入数据校验
2. 在校验表单输入时使用第三方JS插件

# 实验二的解读

&emsp;&emsp;

&emsp;&emsp;

# 实验三：文本里的JS对象——使用JSON格式数据

&emsp;&emsp;本实验将要用到一个公开在万维网上的JSON数据服务：

>[http://services.groupkt.com/country/get/iso2code/CN](http://services.groupkt.com/country/get/iso2code/CN)。

目的：

1. 在页面上展示JSON格式数据
2. 编制自己的JSON格式数据

## 3.1 制作消费JSON数据的网页

### 在本地查看JSON数据格式

&emsp;&emsp;你只需要在http地址的字符串末尾输入代表其他国家名称的两位ISO标准编码，就可以得到一个记录了该国完整名称的JSON格式数据。

 ![js_data_inter_change_json_01](/public/img/js/js_data_inter_change_json_01.gif)

&emsp;&emsp;把页面返回的JSON格式数据复制下来，在文本编辑器里面另存为后缀名是“.json”的文件。

 ![js_data_inter_change_json_02](/public/img/js/js_data_inter_change_json_02.gif)

### 从网上获取JSON格式数据

&emsp;&emsp;新建一个空白HTML文件，用于演示JSON格式数据的转换。

 ![js_data_inter_change_json_03](/public/img/js/js_data_inter_change_json_03.gif)

&emsp;&emsp;然后在网页头部加入以下JavaScript脚本：

    var getJSON = function(url, successHandler, errorHandler) {
	    var xhr = typeof XMLHttpRequest != 'undefined'
		    ? new XMLHttpRequest()
		    : new ActiveXObject('Microsoft.XMLHTTP');
	    xhr.open('get', url, true);
	    xhr.onreadystatechange = function() {
		    var status;
		    var data;
		    if (xhr.readyState == 4) { // `DONE`
			status = xhr.status;
            /* 状态码是200表明发出的服务器响应就绪,
               可以从xhr对象获取服务器返回的文本文字了 */
			if (status == 200) {
			    var responseText = xhr.responseText;
                //调用successHandler函数
				successHandler && successHandler(responseText);
			} else {
				errorHandler && errorHandler(status);
			}
		}
	};
	    xhr.send();
    };

    /* 
       在不影响当前窗口地址、刷新页面的情况下
       向指定万维网地址发送请求，读取返回结果
     */
        getJSON('http://services.groupkt.com/country/get/iso2code/CN', function(responseText) {
	        console.log('从服务器返回的内容是：' + responseText);
            console.log('reponseText的变量类型是：' + typeof(responseText));  
        }, function(status) {
	        console.log('发生错误，状态代码是：'+status);
        });

&emsp;&emsp;刷新页面以后在控制台输出服务器返回的数据格式：

 ![js_data_inter_change_json_04](/public/img/js/js_data_inter_change_json_04.gif)

&emsp;&emsp;经过对比，控制上显示的内容如之前在本地保存的“data.json”文件内容完全一致。

### 用JS语言展示数据

&emsp;&emsp;接下来我们把从万维网上直接获取的JSON数据格式的字符串装换成JS对象。

&emsp;&emsp;在*getJSON*方法里面加入一下代码：

    var responseObj = eval("("+responseText+")");
    console.log('使用eval函数之后的结果是：' + typeof(responseObj));
    console.table(responseObj);

&emsp;&emsp;重新刷新页面，检查控制台可以看到：

 ![js_data_inter_change_json_05](/public/img/js/js_data_inter_change_json_05.gif)

&emsp;&emsp;继续向*getJSON*方法追加以下代码：



## 3.2 生产自己的JSON数据

### 从简单文本开始

### 从JS对象开始

&emsp;&emsp;

&emsp;&emsp;

# 实验三的解读