---
layout: post
title: JavaScript语言访问和操作网页
category: Web前端入门教程
tags: Web前端
description: 本章的主要介绍如何用JavaScript语言在浏览器里面访问并且修改HTML、CSS，做出用户体验好、功能强大的动态网页。
author: 曹小虎
keywords: lanqiao 蓝桥 全栈 教程 Web前端
---

> 本章目标

- 浏览器对象模型（BOM）
- 文档对象模型（DOM）


&emsp;&emsp;现在的浏览器都已经被模型化（modleing），抽象成能用JavaScript语言访问和操作的JS对象，这就是**Browser Object Model**,简称**BOM**。

# 实验一：认识浏览器对象模型

目的：

 1. 掌握DevTools控制台的使用方法
 2. 深入理解JavaScript语言窗口对象window

## 1.1 window对象常用属性

&emsp;&emsp;在Chrome DevTools Console里面，有一个名称为“window”的JavaScript对象。

 ![js_dom_bom_in_dev_tools_01](/public/img/js/js_dom_bom_in_dev_tools_01.gif)

&emsp;&emsp;它在浏览器对象模型（Browser Object Model）里面代表着已经打开的当前窗口。

### 窗口宽高和位置

&emsp;&emsp;在Chrome DevTools Console里面，手工输入以下代码、回车确认：

    window.innerWidth
    window.innerHeight//请调整内侧窗口大小，查看属性值变化
    window.outerWidth
    window.outerHeight//请调整外侧窗口大小，查看属性值变化
    window.screenX
    window.screenY//请调整窗口位置，查看属性值变化

### navigator对象

&emsp;&emsp;在Chrome DevTools Console里面，手工输入以下代码、回车确认：

    console.dir(window.navigator)
    window.navigator===navigator
    navigator.appName
    navigator.appCodeName
    navigator.platform
    navigator.cookieEnabled
    navigator.product
    navigator.appVersion
    navigator.userAgent
    navigator.language
    navigator.javaEnabled()

### screen对象

&emsp;&emsp;在Chrome DevTools Console里面，手工输入以下代码、回车确认：

    console.dir(window.screen)//查看window.screen对象内容
    window.screen===screen
    screen.width　//你的屏幕宽度几个像素？
    screen.height　//你的屏幕高度几个像素？
    screen.availWidth　//
    screen.availHeight//
    screen.colorDepth//你的屏幕用多少比特位显示颜色？
    screen.pixelDepth//你的屏幕pixelDepth属性是多少？

### history对象

&emsp;&emsp;点击超级链接[http://www.lanqiao.org](http://www.lanqiao.org)，在浏览器里面打开一个新窗口。

&emsp;&emsp;使用鼠标滚轮，模拟从上到下浏览页面的动作，页面底部，最后滚动到“蓝桥杯大赛”的页面位置。

&emsp;&emsp;在Chrome DevTools Console里面，用键盘逐行输入以下代码、回车确认：

    console.dir(window.history)
    window.history===history
    window.history.length
    window.history.back()//请反复执行五次
    window.history.forward()//请反复执行五次
    window.history.go(-2)//请反复执行五次
    window.history.go(2)//请反复执行五次
    window.history.go(-1)//请反复执行五次
    window.history.go(1)//请反复执行五次

### location对象

&emsp;&emsp;在蓝桥官网窗口打开DevTools的控制台，手动逐行输入以下代码，然后回车确认。

&emsp;&emsp;注意这个时候窗口发生了什么：

    console.dir(window.location)
    window.location===location
    window.location.href
    window.location.hostname
    window.location.pathname
    window.location.protocol
    window.location.assign("http://www.github.com")

## 1.2 让浏览器窗口动起来

### 检查window对象的工具

&emsp;&emsp;请你在空白页面打开Chrome DevTools的控制台，手动逐行输入以下代码，然后回车确认。

&emsp;&emsp;注意这个时候窗口发生了什么：

    //alert
    window.alert===alert
    window.alert
    alert('Hello World')
    //confirm
    window.confirm===confirm
    window.confirm
    //此行代码请执行两次
    console.log(window.confirm("Are you sure it is true?"))
    //prompt
    window.prompt===prompt
    window.prompt
    //此行代码请执行两次
    console.log(window.prompt("What is your name?"))
    //其他常用方法

    /* 调用窗口动作 */

    //open方法
    window.open===open
    window.open
    var win = window.open('http://www.github.com');
    //close方法
    window.close===close
    window.close
    win.close();

    //setInterval方法
    window.setInterval===setInterval
    window.setInterval
    var timer = window.setInterval(function(){ console.log('Hello World!'); },1000);
    window.clearInterval(timer);

    //setTimeout方法
    window.setTimeout===setTimeout
    window.setTimeout
    var timer2 = window.setTimeout(function(){ console.log('Hello World!'); },5000);
    window.clearTimeout(timer2);

&emsp;&emsp;没有意外的话，你应该还会在控制台看到[Web API接口 window对象](https://developer.mozilla.org/zh-CN/docs/Web/API/Window)页面上介绍的变量、函数和对象。

### 窗口里的document对象

&emsp;&emsp;你可以在控制台输入以下代码，查看控制台输出结果：

    window.document===document
    document
    document.constructor
    //查看document对象的属性
    document.URL
    document.all
    document.head
    document.body
    document.contentType
    document.characterSet
    document.cookie
    document.doctype
    //查看document对象的方法
    document.getElementById
    document.getElementsByName
    document.getElementsByTagName
    document.getElementsByClassName
    document.getSelection

&emsp;&emsp;window.document是浏览器窗口上Web网页内容（HTML文档）的入口。打开[MDN Web API接口  Document](https://developer.mozilla.org/zh-CN/docs/Web/API/document)页面，你可以开始探索有关HTML文档对象的更多属性和方法。

## 1.3 访问JavaScript全局作用域

### 访问JavaScript标准库成员

&emsp;&emsp;请你在Chrome DevTools的控制台里面输入以下代码，记录控制台的输出结果：

    window.Object===Object
    Object
    window.undefined===undefined
    undefined
    window.Infinity===Infinity
    Infinity
    window.String===String
    String
    window.NaN===NaN
    NaN
    window.Function===Function
    Function
    window.isFinite===isFinite
    isFinite

&emsp;&emsp;没有意外的话，你应该还会在控制台看到[MDN JavaScript标准库](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects)页面上介绍的变量、函数和对象。

&emsp;&emsp;

&emsp;&emsp;

# 实验一的解读

## Browser Object Model

### window对象

&emsp;&emsp;把浏览器当成一个对象，并且从Web前端编程的实际需要出发，抽象出一个实用模型，这就是浏览器对象模型（Browser Object Model,简称BOM）。

&emsp;&emsp;它可以让浏览器“听懂”JavaScript语言。借助这个模型，我们可以写出JavaScript代码，查看浏览器关键属性，打开、调整、移动、关闭一个新窗口，同时也可以修改网站页面的结构、内容，样式和行为。它就是一个架设在纯粹ECMAScript和实际各大厂商的浏览器之间的一个桥梁、通道。

 ![js_bom_bridge](/public/img/js/js_bom_bridge.png){:width="300px" height="200px"}

&emsp;&emsp;BOM里面的一切对象都是在浏览器里面可以用JavaScript语言访问、操作JavaScript对象。所有的BOM对象组成了一个类似树形结构，这棵树最顶端的一个对象就是window,这个名字表明它代表了一个打开到一个网页的浏览器窗口。window对象包含若干重要属性、方法和对象，这些正是我们需要关注的主要内容。

 ![overview_of_bom](/public/img/js/overview_of_bom.gif){:width="500px" height="400px"}

&emsp;&emsp;更多window对象的属性和方法列表，请直接点击W3CSchool的[Window 对象](http://www.w3school.com.cn/jsref/dom_obj_window.asp)。

&emsp;&emsp;**window**对象是浏览器对象模型的顶层对象，也可以被称为“**全局对象**”。定义在window对象上的属性被称为“**全局属性**”。

&emsp;&emsp;在Web前端进行JavaScript编程，JS代码运行在一个专有的浏览器窗口(window)里，浏览器对象模型的顶层对象window也就是当前运行环境的全局作用域。我们可以在这个全局作用域里查到ECMAScript规范中约定的的JS对象定义。

### window对象常见属性

&emsp;&emsp;**window.navigator**对象包含了关于用户浏览器的多项有用信息。

&emsp;&emsp;有了**window.location**对象，我们既可以查询到窗口里面的当前页面地址，也可以把当前窗口重新指向另外一个网页。

&emsp;&emsp;警告!!!这是一个历史遗留问题：**window.navigator**对象上的信息具有误导性，因此任何人不应该以来这个对象提供的信息测试浏览器的厂商和版本信息。

&emsp;&emsp;**window.screen**对象包含有关显示器屏幕的信息。

### HTML 文档对象

&emsp;&emsp;浏览器会把被下载到本地的HTML文件解析成一个“document object model”，也就是“文档对象”。在浏览器对象模型中，对应于由HTML页面转化而来的文档对象，是window对象上面一个名字是“**document**”的一个属性。

&emsp;&emsp;

&emsp;&emsp;

# 实验二：实时监控浏览器窗口

目的：

 1. 编写JavaScript代码，通过window.document对象修改网页内容
 2. 用window对象下的工具函数setInterval和clearInterval管理定时任务

## 2.1 准备页面内容

### 增加控制按钮

&emsp;&emsp;首先我们需要准备一个空白页面。

&emsp;&emsp;在页面区域加入以下按钮代码：

    <!-- 点击按钮，调用函数打开窗口 -->
    <button onclick="openWin()">Create window</button>
    <!-- 点击按钮，调用函数修改窗口尺寸 -->
    <button onclick="resizeWin()">Resize window</button>
    <!-- 点击按钮，调用函数关闭窗口 -->
    <button onclick="closeWin()">Close window</button>

### 制作窗口属性值数据表格

&emsp;&emsp;继续在页面上增加一个用于显示新窗口属性的表格。

&emsp;&emsp;下面是数据表格的结构和内容：

    <h1>myWindow常用属性</h1>
    <table>
      <tr>
        <td>X坐标:</td><td id="screenXValue"></td>
        <td>Y坐标:</td><td id="screenYValue"></td>
      </tr>
      <tr>
        <td>innerWidth:</td><td id="innerWidthValue"></td>
        <td>innerHeight</td><td id="innerHeightValue"></td>
      </tr>
      <tr>
        <td>outerWidth:</td><td id="outerWidthValue"></td>
        <td>outerHeigth:</td><td id="outerHeigthValue"></td>
      </tr>
      <tr>
        <td>窗口名字:</td><td id="nameValue"></td>
        <td>是否关闭:</td><td id="isClosedValue"></td>
      </tr>
    </table>

## 2.1 编写JavaScript代码

&emsp;&emsp;为页面头部的“script”标签里面增加内容：

    <script>
    function openWin() {
     alert("将要打开一个新窗口！")
    }

    function closeWin() {
     alert("将要关闭这个新窗口！")
    }   

    function resizeWin() {
     alert("将要调整这个新窗口的尺寸！")
    }   

    function moveWin() {
     alert("将要移动这个新窗口！")
    }
    </script>

### openWin

&emsp;&emsp;在所有函数的外部声明一个名字是“**myWindow**”的变量，用来保存即将打开的的窗口对象。

    //声明一个变量，用来保存即将打开的新窗口
    var myWindow;

&emsp;&emsp;充实“openWin”方法的函数体内容，定义打开新窗口的过程。

&emsp;&emsp;详细代码如下：
    
    //Point-1：按钮点击事件之打开窗口
    function openWin() {
       //如果窗口已经定义,就不需要再打开一个
       if(myWindow) return;
       //Point-1.1：调用窗口的确认确认对话框
       var ok = window.confirm("你确定要打开一个新窗口吗？单击“确定”继续，单击“取消”停止。");
       if(ok){
       //Point-1.2：调用窗口提示输入对话框
       var winName = window.prompt("欢迎！请输入新窗口的名字：");
       //Point-1.3：调用窗口警示对话框
       window.alert("您输入的窗口名字是："+winName);
       myWindow = window.open("", winName, "width=500, height=300");
       }else{
       alert("您刚才点击了“取消按钮”!");
       }
    }

### resizeWin

&emsp;&emsp;充实“resizeWin”方法的函数体内容，定义修改新窗口大小的过程。

&emsp;&emsp;详细代码如下：

     //Point-2：按钮点击事件之关闭窗口
    function resizeWin() {
       if(myWindow){
       //Point-3.1：调整窗体尺寸大小、获得焦点
       myWindow.resizeTo(700, 600);
       myWindow.focus();
       } 
    }

### 更新表格内容

&emsp;&emsp;要想修改单元格\<td\>里面的内容，需要先找到对应docuemnt节点，修改它的innerHTML属性值。下面是整个方法的代码：

     //Point-5.1：查询DOM节点，更新节点内容
    function setTableContent(){
       document.getElementById('screenXValue').innerHTML=myWindow.screenX;
       document.getElementById('screenYValue').innerHTML=myWindow.screenY;
       document.getElementById('innerWidthValue').innerHTML=myWindow.innerWidth;
       document.getElementById('innerHeightValue').innerHTML=myWindow.innerHeight;
       document.getElementById('outerWidthValue').innerHTML=myWindow.outerWidth;
       document.getElementById('outerHeigthValue').innerHTML=myWindow.outerHeight;
       document.getElementById('nameValue').innerHTML=myWindow.name;
       document.getElementById('isClosedValue').innerHTML=myWindow.closed; 
    }

&emsp;&emsp;只需要在window.open之后，调用setTableContent这个函数就行了,更新openWin函数的内容：

    //Point-1：按钮点击事件之打开窗口
    function openWin() {
       /* 此处省略多行代码  */
       myWindow = window.open("", winName, "width=500, height=300");
       setTableContent();
       /* 此处省略多行代码 */
    }

### 实时监控窗口属性

&emsp;&emsp;我们计划每一秒钟执行一次“setTableContent”方法。

&emsp;&emsp;在所有函数的外部声明一个名字是“**timer**”的变量，用来保存即将开启的定时任务id。

    //声明一个变量，用来保存即将开启的定时任务id
    var timer;

&emsp;&emsp;用**setInterval**定时工具调用setTableContent函数。

    //Point-1：按钮点击事件之打开窗口
    function openWin() {
       /* 此处省略多行代码  */
       myWindow = window.open("", winName, "width=500, height=300");
       //更新窗口属性表格里面的内容
      setInterval(setTableContent,1000);
       /* 此处省略多行代码 */
    }

### closeWin

&emsp;&emsp;充实“closeWin”方法的函数体内容，定义修改新窗口大小的过程。

&emsp;&emsp;详细代码如下：

     //Point-2：按钮点击事件之关闭窗口
    function closeWin() {
       if(myWindow){
        //调用窗口对象的关闭方法
         myWindow.close();
        //最后一次更新数据表格
        setTableContent();
        //根据id清除定时任务
        clearInterval(timer);
        //令myWindow变量为空
        myWindow=null;
       } 
    }

&emsp;&emsp;

&emsp;&emsp;

# 实验二的解读

&emsp;&emsp;本次实验完成了一个用Javascript语言修改网页数据表格内容的例子。

## window.document对象

&emsp;&emsp;这是浏览器对象模型（BOM）的顶层对象window上的一个重要属性，代表了显示在浏览器窗口里的网页实际内容。

 ![js_dom_bom_doc_in_dev_tools_01](/public/img/js/js_dom_bom_doc_in_dev_tools_01.gif)

&emsp;&emsp;在控制台检查当前浏览器窗口的document属性，可以看到：

1. 它是一个JavaScript对象
2. 它是一个以“document”节点作为根的树形结构
3. document树的节点对应了HTML元素，HTML元素的名字是节点的名字，HTML元素的属性就是节点属性，HTML元素的内容是当前节点的子节点
4. 它的构造函数是HTMLDocument

###  选中和修改td节点

&emsp;&emsp;打开控制台，用DevTools的选择器工具选中id值是“screenXValue”的“td”元素，

&emsp;&emsp;DevTools的Elements面板下方，选中选中第一个“Styles”和最后一个“Properties”面板，分别查看其中的内容，最终发现：

1. Styles面板显示了td元素的样式来自浏览器默认样式“user agent stylesheet”
2. Properties面板纪录了td元素的类型是*HTMLTableCellElement*，它的祖先类型是“Object”

&emsp;&emsp;切换到“Console”，通过定义在document上的*getElementById*方法查询td元素，并且声明一个变量保存它。然后就可以通过查询、修改变量的“*innerHTML*”属性来改变单元格显示在网页上的内容了。

 ![js_dom_bom_doc_in_dev_tools_02](/public/img/js/js_dom_bom_doc_in_dev_tools_02.gif)

有关*document.getElementById*方法请参考：[MDN Web API document.getElementById](https://developer.mozilla.org/zh-CN/docs/Web/API/Document/getElementById)。

有关*innerHTML*属性的更多详情，请参考：[MDN Web API  innerHTML属性](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/innerHTML)页面。

&emsp;&emsp;

## 定时工具

 ![js_dom_bom_doc_in_dev_tools_03](/public/img/js/js_dom_bom_doc_in_dev_tools_03.gif)

### setInterval定时工具

&emsp;&emsp;我们在实验二里用到window对象下的一个工具函数setInterval设置定时任务。从字面上看，interval的含义是“间隔、频率”，setInterval就是设定（干一件事情的）间隔和频率。

&emsp;&emsp;serInterval函数接收两个参数，第一个参数是描述干什么事的一个函数，第二个参数是间隔多长时间（以毫秒为单位计算时间）。

&emsp;&emsp;函数调用成功以后返回一个*定时任务的唯一id*。有关setInterval函数的完整信息，请参考[MDN Web API接口 window.setInterval](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/setInterval)页面。

### clearInterval清除定时任务

&emsp;&emsp;clearInterval的主要功能是：接收一个由setInterval函数返*定时任务id*，停止执行这个定时任务。

&emsp;&emsp;关于[setInterval](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/setInterval)函数的具体用法，请直接查阅链接资料。

&emsp;&emsp;

&emsp;&emsp;


# 实验三： 制作电子时钟

目的：

1. 使用JavaScript日期对象和窗口定时任务工具
2. 使用HTML元素的onclick、onmouseover和onmouseout属性定义页面元素事件
3. 使用JavaScript代码修改页面元素样式（style）属性

 ![js_dom_bom_clock_demo_01](/public/img/js/js_dom_bom_clock_demo_01.gif)

## 3.1 定义页面内容和样式

### 增加显示时间的页面分区（division）

&emsp;&emsp;在页面主体部分增加一个DIV:

	<div id="container">
    <div id="clock">
        <span id="hour" onmouseover="paintGold(this)" 
        onmouseout="recoverColor(this)">hh</span>:
        <span id="min" onmouseover="paintGold(this)" 
        onmouseout="recoverColor(this)">mm</span>:
        <span id="sec" onmouseover="paintGold(this)" 
        onmouseout="recoverColor(this)">ss</span>
    </div>

	</div>

&emsp;&emsp;其中，为每个元素都id元素赋值。

### 控制时钟数字字体颜色

&emsp;&emsp;为了让时钟的数字显示出不同颜色，在HTML页面头部加入下面的代码:

    <style>
	  #container { 
	    margin-left:auto;
	    margin-right:auto;
	    width:60%;
	    background-image: url('../imges/timeflow.jpg') ;
	    background-size: 99.9% 99.9%;
	    height:700px; 
	    display: table;
	  }
	  #clock { 
	    margin:0 auto; 
	    width:400px; 
	    height:100px; 
	    display: table-cell;
	    vertical-align: middle;
	    text-align:center;
	    font-size:50px;
	  }
	  
	  #btn {
	    display: table-cell;
	    vertical-align: middle;
	    text-align:center;
	    font-size:50px;	  
	  }
    </style>

### 增加时钟控制按钮

&emsp;&emsp;在id是“clock”的div下面，增加一个新div：

	<div id="btn">
	    <input type="button" onclick="clockStart()" value="Start"/>
        <input type="button" onclick="clockStop()" value="Stop"/>
	</div>

&emsp;&emsp;其中，我们已经定义了它们的点击事件对应的函数名称。

## 3.2 编写动态脚本

### 增加按钮点击处理函数

&emsp;&emsp;继续上面一步，定义对应的事件处理函数

      function clockStart() {
       alert("clock button clicked");
      }
        
      function clockStop() {
       alert("clock button clicked");
     }

### 查找并且显示当前小时分钟秒

&emsp;&emsp;定义一个函数:

       /*
        如果（if）当前时间小时、分钟、秒数少于10，那么就在显示出来的数字前面补一个０
       */
      function update() {
       //获取当前系统时间
       var date = new Date();
       //小时
       var hours = date.getHours();
       if (hours < 10) hours = '0'+hours;
       //分钟
       var minutes = date.getMinutes();
       if (minutes < 10) minutes = '0'+minutes;
       //秒
       var seconds = date.getSeconds();
       if (seconds < 10) seconds = '0'+seconds;
       }


### 更新DOM节点显示内容

&emsp;&emsp;这里我们要查找DOM节点，把刚才获取到的事件信息写入到节点里面去，在update函数的末尾追加代码：

       document.getElementById('hour').innerHTML = hours;
       document.getElementById('min').innerHTML = minutes;
       document.getElementById('sec').innerHTML = seconds;


### 设置定时任务

&emsp;&emsp;要达到实施更新页面内容的目的，只有使用“setInterval”全局方法。

&emsp;&emsp;由于我们计划随后要停止这个定时任务，有必要保存它的id值。

&emsp;&emsp;第一步：在代码开头位置声明一个变量：

      // current timer if started
      var timerId; 

&emsp;&emsp;第二步：充实clockStart函数内容：

      function clockStart() {  
       if (timerId) return;
       //使用setInterval方法，以１秒为间隔，调用update方法
       timerId = setInterval(update, 1000) ;
       //立即更新时钟
       update();
      }

&emsp;&emsp;第三步：编写关闭时钟的方法：

      function clockStop() {
       //根据id清除定时任务
       if(timerId){
       clearInterval(timerId);
       //清除变量值
       timerId = null;
       }
      }


### 控制字体颜色

&emsp;&emsp;我们希望当鼠标移动到时钟数字上的时候，字体颜色变为金色；当鼠标移走以后再恢复原状。

&emsp;&emsp;第一步：为HTML元素增加onmouseover函数：

    <div id="clock">
      <span id="hour" onmouseover="paintGold(this)">hh</span>:
      <span id="min" onmouseover="paintGold(this)">mm</span>:
      <span id="sec" onmouseover="paintGold(this)">ss</span>
    </div><br/>

&emsp;&emsp;第二步：编写处理事件的函数paintGold：

      function paintGold(el){
       el.style.color='gold'
      }

&emsp;&emsp;第三步：为HTML元素增加onmouseout函数：

    <div id="clock">
      <span id="hour" onmouseover="paintGold(this)" onmouseout="recoverColor(this)">hh</span>:
      <span id="min" onmouseover="paintGold(this)" onmouseout="recoverColor(this)">mm</span>:
      <span id="sec" onmouseover="paintGold(this)" onmouseout="recoverColor(this)">ss</span>
    </div><br/>

&emsp;&emsp;第四步：编写处理事件的函数recoverColor：

      function recoverColor(el){
       if(el.id==='hour'){
       el.style.color='red';
       }else if(el.id==='min'){
       el.style.color='green';
       }else{
       el.style.color='blue';
       }
      }

最后，重新运行代码，可以看到鼠标事件生效。




# 实验四：探索DOM事件冒泡原理

目的：认识点击事件在网页dom文档的树形结构上的传播过程。

## 4.1 建立文档树形结构

### HTML代码

&emsp;&emsp;在一个空白页面的里面加入以下代码：

     <!-- 页面内容区开始 -->
     <div>
      DIV Element
      <span>
      SPAN Element
        <input type="button" value="Click Me" onclick="alert('button clicked!')"/>
      </span>
     </div>
     <!-- 页面内容区结束 -->

### CSS样式

&emsp;&emsp;在HTML头部加入以下代码：

    <style>
    .styleClass
    {
      display:table-cell;
      border:1px solid black;
      padding:20px;
      text-align:center;
    }
    </style>

&emsp;&emsp;把这些样式应用到HTML元素：

    <div class="styleClass">
     DIV Element
     <span class="styleClass">
     SPAN Element
     <input class="styleClass" type="button" value="Click Me"/>
     </span>
    </div>

### 增加点击事件响应函数

    <div class="styleClass" onclick="alert('DIV Clicked!');">
     DIV Element
     <span class="styleClass" onclick="alert('SPAN Clicked!');">
     SPAN Element
     <input class="styleClass" type="button" value="Click Me" 
            onclick="alert('button clicked!')"/>
     </span>
    </div>

## 4.2 观察事件在dom节点上冒泡

### 测试事件冒泡过程

&emsp;&emsp;点击按钮，测试事件传播过程。

&emsp;&emsp;只保留最外层DIV的onclick属性，删除其他两个onclick属性，再测试会发生什么。

     <div class="styleClass" 
      onclick="alert('Button clicking is handled by DIV Element');">
      DIV Element
      <span class="styleClass"">
      SPAN Element
        <input class="styleClass" type="button" value="Click Me"/>
      </span>
     </div>

### 观察触发事件的元素对象

&emsp;&emsp;清除页面BODY元素内部原有的代码，写好三个嵌套的DIV:

    <div class="styleClass" id="DIV1">DIV1
      <DIV class="styleClass" ID="DIV2">DIV2
        <DIV class="styleClass" ID="DIV3">DIV3</DIV>
      </DIV>
    </DIV>

&emsp;&emsp;用下面的代码覆盖styleClass里面的border属性：

        border:5px solid black;

&emsp;&emsp;在HTML页面BODY底部增加JS代码：

    <SCRIPT TYPE="text/javascript">
    var divElements=document.getElementsByTagName('div');
    for(var i=0;i<divElements.length;i++){
    divElements[i].onclick=function(){
      //这里的"this"专门指代发生点击事件的DOM节点
      this.style.borderColor='red';
      alert(this.id+' border color changed!')
    };
    }
    </SCRIPT>

&emsp;&emsp;请你分别点击三个DIV元素记录并且解释原因。

### 阻止事件冒泡

&emsp;&emsp;有时候我们需要阻断HTML文档的事件冒泡的过程。

&emsp;&emsp;请你用下面的代码改写DOM节点onclick事件对应的函数：

    <SCRIPT TYPE="text/javascript">
    var divElements=document.getElementsByTagName('div');
    for(var i=0;i<divElements.length;i++){
    divElements[i].onclick=function(event){//每次触发事件，都会有一个event对象传入
      event= event ||window.event;//处理IE9之前的兼容问题
      
      if(event.stopPropagation){
       event.stopPropagation();////停止冒泡
      }else{
       event.cacelBubble=true;//在IE9之前的浏览器里面停止冒泡
      }
    
      this.style.borderColor='red';
      alert(this.id+' border color changed!')
    };
    }
    </SCRIPT>

&emsp;&emsp;点击不同的DIV元素，查看事件冒泡过程是否被阻断。

&emsp;&emsp;

&emsp;&emsp;

# 实验五：用JS脚本维护下拉列表

# 5.1 用JavaScript创建下拉列表

### 准备省份和城市的数组

&emsp;&emsp;我们需要一个表示省份名称的一维数组，一个表示城市名称的二维数组。

&emsp;&emsp;在空白文档的头部加入如下代码：

    <SCRIPT TYPE="text/javascript">
    var provinces = ['广东','湖南','湖北','河南','河北'];
    var citiesArrByProvinces = 
      [['广州','深圳','韶关','东莞','汕头','揭阳'],
      ['长沙','衡阳','常德','怀化','郴州','株洲'],
      ['武汉','襄阳','宜昌','黄冈','十堰','荆门'],
      ['郑州','洛阳','开封','新乡','三门峡','许昌','平顶山'],
      ['石家庄','保定','邢台','衡水','唐山','秦皇岛']];

    </SCRIPT>

 
### 创建第一个下拉选项

&emsp;&emsp;第一步：先编写一个JS方法来创建下拉列表：

    <SCRIPT TYPE="text/javascript">
    /*
     ......
     此处省略provinces和citiesArrByProvinces数组数据
     ......
    */

    /* 创建下拉列表 */
    function initProvinceSelect(){
    //获取document对象上的body部分
    var body = document.body;
    //创建HTMLSelectElement类型对象
    var selectObj = document.createElement('select');
    //设置id属性
    selectObj.id='provinceSelect';
    //创建HTMLOptionElement类型对象
    var option = document.createElement('option');
    //设置value属性
    option.setAttribute('value',-1);
    //创建Text类型纯文本对象
    var textNode = document.createTextNode('请选择省份');
    //把已经创建好的对象连接成一个树形结构
    option.appendChild(textNode);
    selectObj.appendChild(option);
    body.appendChild(selectObj);
    }

    </SCRIPT>

&emsp;&emsp;第二步：在页面文档加载好之后，调用刚才创建的函数：

    <BODY onload="initProvinceSelect();"></BODY>

### 使用数组数据创建下拉选项

&emsp;&emsp;我们需要把数组**provinces**里面的数据写到列表的下拉选项里面去。

&emsp;&emsp;已经知道，增加下拉选项的需要创建**HTMLOptionElement**类型的JS对象，并且把它加入（appenChild）到**HTMLSelectElement**的子节点集合里面去。

    <SCRIPT TYPE="text/javascript">
    /*
     ......
     此处省略provinces和citiesArrByProvinces数组数据、initProvinceSelect方法
     ......
    */

    /*
      根据provinces数据创建下拉列表内容
      selectObj HTMLSelectElement类型的下拉列表对象
    */
    function createOptionList(selectObj){
     
     for(var i=0;i<provinces.length;i++){
     //创建HTMLOptionElement类型对象
     var option = document.createElement('option');
     //设置value属性：数组下标
     option.setAttribute('value',i);
     //创建Text类型纯文本对象：文本内容是数组里的省份名称
     var textNode = document.createTextNode(provinces[i]);
     //把已经创建好的对象连接成一个树形结构
     option.appendChild(textNode);
     selectObj.appendChild(option);
     }
    }

    </SCRIPT>

&emsp;&emsp;除此之外，我们还需要在initProvinceSelect方法末尾调用这个函数：

    /* 创建下拉列表 */
    function initProvinceSelect(){
    /*
     ......
     此处省略代码若干行
     ......
    */
    var selectObj = document.createElement('select');
    /*
     ......
     此处省略代码若干行
     ......
    */
    //创建下拉选项
    createOptionList(selectObj);
    }

## 5.2 用JavaScript增加事件

### 为下拉列表添加onchange事件函数

&emsp;&emsp;在**HTMLSelectElement**类型的JS对象有一个名字是“onchange”的属性，它的值应该是一个函数的时候。当用户修改选中的选项时，这个函数会被调用。首先写下将要被调用的函数：

    function onProvinceSelected(event){
     alert('onProvinceSelected:'+event);
    }

&emsp;&emsp;在initProvinceSelect函数末尾注册事件监听函数：

    /* 创建下拉列表 */
    function initProvinceSelect(){
    /*
     ......
     此处省略代码若干行
     ......
    */
    var selectObj = document.createElement('select');
    /*
     ......
     此处省略代码若干行
     ......
    */
    //创建下拉选项
    createOptionList(selectObj);
    //
    selectObj.onchange = onProvinceSelected;
    }

&emsp;&emsp;下拉列表的change事件被调用之后，我们可以在被调用函数里面获取到一个[事件对象](http://www.phpstudy.net/e/htmldom/dom_obj_event.html)类型参数,通过查看文档，我们可以知道它有多个属性：

    function onProvinceSelected(event){
     　var type = event.type;
      console.log('那种事件类型发生了？'+type);
      // 那种事件类型发生了？change
      var target = event.target;
      console.log('什么元素触发了事件？'+target+",|| id:"+taget.id); 
      //什么元素触发了事件？\[object HTMLSelectElement\],	id:provinceSelect
    }

&emsp;&emsp;其中event.target属性在这里就是触发事件的HTMLSelectElement对象：

    function onProvinceSelected(event){
     　var type = event.type;
      console.log('那种事件类型发生了？'+type);
      var target = event.target;
      console.log('什么元素触发了事件？'+target+",|| id:"+taget.id);

      var selectObj =event.target;
      console.log("下拉列表选中了：" + selectObj.value);
      console.log('这个省里面的城市数据是：'+citiesArrByProvinces[target.value]);
    }




# 实验五的解读

## 相关的DOM编程API

&emsp;&emsp;这次实验里面，我们的主要工作是基于DOM，用JavaScript编程的方法，创建网页的下拉列表。在此之前，我们有必要熟悉一下如何操作DOM节点。

&emsp;&emsp;你需要在控制台输入下面的代码，据此才能了解这次DOM编程所必需的基础知识。

    var body = document.body
    body.nodeName
    body.nodeType
    body.nodeType===Node.ELEMENT_NODE//节点类型:元素节点
    body.constructor//HTMLBodyElement
    alert(body)
    typeof(body.constructor)
    body.constructor instanceof HTMLBodyElement
    body.constructor instanceof Function

    var selectObj = document.createElement('select');
    selectObj.constructor//HTMLSelectElement
    selectObj.nodeName
    selectObj.nodeType
    alert(selectObj)
    selectObj instanceof HTMLSelectElement
    selectObj.constructor instanceof Function

    var option = document.createElement('option');
    option.constructor
    option.nodeName
    option.nodeType
    option.nodeType===Node.ELEMENT_NODE//节点类型:元素节点
    alert(option)//HTMLOptionElement
    option instanceof HTMLOptionElement
    option.constructor instanceof Function

    var textNode = document.createTextNode('my text');
    textNode.nodeName
    textNode.nodeType
    textNode.nodeType===Node.TEXT_NODE//节点类型:文本节点
    alert(textNode)
    textNode.constructor
    textNode instanceof Text
    textNode.constructor instanceof Function
    

&emsp;&emsp;在上面的例子里，HTMLBodyElement、HTMLSelectElement、HTMLOptionElement和Text分别对应了HTML文档里三种类型的元素：\<body\>、\<select\>、\<option\>和纯文本节点。

&emsp;&emsp;其中前三个这些节点对象的类型，有一个共同的“父类”，包括“祖先”:

 ![html_body_el_tree](/public/img/js/html_body_el_tree.png){:width="200px" height="100px"}
 ![html_body_el_tree](/public/img/js/html_select_el_tree.png){:width="200px" height="100px"}
 ![html_option_el_tree](/public/img/js/html_option_el_tree.png){:width="200px" height="100px"}

&emsp;&emsp;实际上，我们正在进行的JS DOM编程，就是一种真实的“面向对象编程”。在这么一组面向对象的继承关系里，存在于父类上的属性和方法，都会被子类拥有。更多细节，请直接查看[js dom相关文档](http://krook.org/jsdom/)。

# 实验六：用JavaScript语言创建HTML表格

目的：用JavaScript语言创建一个简单的页面数据表格


## 6.1 准备简单表格

### 在页面上增加一个表格和两个按钮 

    <!DOCTYPE html>
    <HTML>
    <HEAD>
    </HEAD>
    <BODY>
    <INPUT type="button" value="Add Row"/>
    <INPUT type="button" value="Delete Row"/>
    <TABLE id="dataTable" width="350px" border="1">
      <TR>
       <TD><INPUT type="checkbox" name="chk"/></TD>
       <TD><INPUT type="text" name="txt"/></TD>
       <TD>
         <SELECT name="country">
           <OPTION value="zh">China</OPTION>
           <OPTION value="in">India</OPTION>
           <OPTION value="de">Germany</OPTION>
           <OPTION value="fr">France</OPTION>
           <OPTION value="us">United States</OPTION>
           <OPTION value="ch">Switzerland</OPTION>
         </SELECT>
        </TD>
       </TR>
    </TABLE>
    </BODY>
    </HTML>

###为两个按钮增加点击事件函数

&emsp;&emsp;为“Add Row”和“Delete Row”按钮注册onclick事件：

    <INPUT type="button" value="Add Row" onclick="addRow('dataTable')"/>
    <INPUT type="button" value="Delete Row" onclick="deleteRow('dataTable')"/>

&emsp;&emsp;为“Add Row”和“Delete Row”按钮添加点击事件函数,在HTML文档头部加入JS代码：

    <SCRIPT language="javascript">
     function addRow(tableId){
       alert('add a row into table with an id of '+tableId);
     }
     function deleteRow(tableId){
       alert('delete a row from the table with an id of '+tableId);
     }
    </SCRIPT>

## 6.2 加入JavaScript代码

### 从Dev Tools Console开始

&emsp;&emsp;打开HTML控制台，选中id是“dataTable”的HTML元素。

&emsp;&emsp;在控制台运行以下代码：

    $0
    $0.rows
    alert($0.rows)
    $0.rows.length
    $0.rows[0]
    $0.rows[1]
    alert($0.rows[0])

    var table = $0
    //查询表格行数
    var rowCount = table.rows.length
    //新创建一个HTMLTableRowElement对象
    var row = table.insertRow(rowCount)
    
    //调用HTMLTableRowElement对象上的方法插入单元格
    var cell = row.insertCell(0)
    //先掌握获取表格第一行三个单元格内容的方法
    var firstRow=$0.rows[0]
    firstRow.cells
    alert(firstRow.cells)
    firstRow.cells.length
    firstRow.cells[0]
    firstRow.cells[1]
    firstRow.cells[2]

    //填充新的单元格
    cell.innerHTML=table.rows[0].cells[0].innerHTML
    var cell = row.insertCell(1)
    cell.innerHTML=table.rows[0].cells[1].innerHTML
    var cell = row.insertCell(2)
    cell.innerHTML=table.rows[0].cells[2].innerHTML


### 在表格里面增加一行数据

&emsp;&emsp;综合上一小节掌握的DOM编程接口，我们整理出一个通过JS代码动态添加数据表格内容的方法。这就是“addRow”函数需要完成的功能：

    <SCRIPT language="javascript">
    function addRow(tableId){
       //根据id查询DOM节点
       var table = document.getElementById(tableId);
       //查询表格里的总行数
       var rowCount = table.rows.length;
       var row = table.insertRow(rowCount);
       var colCount = table.rows[0].cells.length;
       for(var i=0; i<colCount; i++) {
       var newcell = row.insertCell(i);
       newcell.innerHTML = table.rows[0].cells[i].innerHTML;
       }
    }

     /* 此处省略deleteRow函数代码...... */

    </SCRIPT>

&emsp;&emsp;点击“Add Row”按钮，给表格添加新的行，你可以在这些新增行里面填写任何内容。

 ![add_table_row_in_js](/public/img/js/add_table_row_in_js.png){:width="500px" height="400px"}

###  定义删除表格行的函数

&emsp;&emsp;在Chrome开发者工具里面选中“dataTable”元素，在控制台用如下代码删除一行记录：

    var table = $0
    table.rows
    table.rows.length
    table.rows[0]
    table.rows[1]
    //调用HTMLTableElement对象上面的deleteRow方法
    //需要传入以０开始的行数字下标作为参数
    table.deleteRow(1)

&emsp;&emsp;先用最简单的方法，删除表格里面的第一行记录：

    <SCRIPT language="javascript">

     /*此处省略addRow函数代码*/

     /*...*/
     function deleteRow(tableId){
       //获得表格对象
       var table = document.getElementById(tableId);
       //获得表格行数
       var rowCount = table.rows.length;
       //删除下标为0的行
       table.deleteRow(0);
     }
    </SCRIPT>

&emsp;&emsp;运行代码，新增任意数目的行记录，测试“deleteRow”按钮是否正常工作。

### 根据checkbox删除表格行

&emsp;&emsp;第一步：需要在表格中找到checkbox对象：

    var table = $0;
    var row = table.rows[0]
    var chxCell = row.cells[0]
    chxCell
    chxCell.childNodes
    alert(chxCell.childNodes)
    chxCell.childNodes
    chxCell.childNodes.length
    var checkbox = chxCell.childNodes[0]
    alert(checkbox)
    //请你用鼠标点击checkbox
    //检查checkbox的选中状态是否发生变化
    checkbox.checked

&emsp;&emsp;第二步,遍历表格全部行记录，检查checkbox元素的选中对象，决定是否删除行记录：

    <SCRIPT language="javascript">
     /*此处省略addRow函数代码*/
     /*...*/
     function deleteRow(tableId){
     //获得表格对象
     var table = document.getElementById(tableId);
     //获得表格行数
     var rowCount = table.rows.length;
     //查找每一行的checkbox对象，检查它的状态
     for(var i=0; i<rowCount; i++) {
     var row = table.rows[i];
     var chkbox = row.cells[0].childNodes[0];
     //如果checkbox存在，并且已经被选中
     if(null != chkbox && true === chkbox.checked) {
      /*
       保证表格里面始终有一行记录不被删除
       这一行记录会成为新增行内容的“模板”
      */
       if(rowCount <= 1) {
	   alert("Cannot delete all the rows.");
	   break;
       }
     　　//删除本行数据
       table.deleteRow(i);
       //更新最新的行数rowCount和下标
       rowCount--;
       i--;
       }
      }
     }
    </SCRIPT>

&emsp;&emsp;

&emsp;&emsp;


# 实验六的解读

## 用Chrome DevTools的Elements面板和JS控制台

### 查看实际网站

&emsp;&emsp;请你打开蓝桥官网：[http://www.lanqiao.org](http://www.lanqiao.org):

&emsp;&emsp;第一步，我们在“Elements”面板选中超文本元素“我们的服务”，

 ![select_el_demo](/public/img/js/select_el_demo.png){:width="500px" height="400px"}

&emsp;&emsp;然后在控制台输入下面的JS代码，并且查看输出:

    $0
    $0.href
    $0.onclick
    $0.title
    $0.innerText
    $0.innerHTML

&emsp;&emsp;第二步，进一步选中其中的图片元素，在控制台输入以下JS代码,查看输出：

    $0.src
    $0.style

&emsp;&emsp;第三步，在同一个页面上，找到id是“fullPage”的DIV元素，选中它，

 ![select_full_page_el](/public/img/js/select_full_page_el.png){:width="500px" height="400px"}

&emsp;&emsp;在控制台输入以下JS代码,查看输出：

    $0.id
    document.getElementById('fullPage')===$0
    $0.classList
    $0.className
    $0.style
    $0.innerHTML

&emsp;&emsp;我们可以通过JavaScript代码查询到任意一个HTML文档对象的内部节点，以及节点的任意一个属性。其中，最方便的办法是通过一个节点的id值快速查找到唯一节点,下面演示了另外几种常见的查找HTML文档节点的方法：

    //演示根据标签名字批量查找元素
    var links = document.getElementsByTagName('link')
    links
    links.length
    alert(links)
    alert(links[0])
    alert(links[0].type)
    alert(links[0].href)
    alert(links[0].rel)
    var imgs = document.getElementsByTagName('img')
    imgs
    imgs.length
    alert(imgs)
    var divs = document.getElementsByTagName('div')
    divs
    divs.length
    alert(divs)
    alert(divs[0])
    alert(divs[0].tagName)

    //演示根据class名批量查找元素
    var menuDiv = document.getElementsByClassName('menu')
    menuDiv
    menuDiv.length
    alert(menuDiv)
    alert(menuDiv[0])
    alert(menuDiv[0].content)
    alert(menuDiv[0].tagName)
    
    //演示根据name属性批量查找元素
    var metaDesc = document.getElementsByName('description')
    alert(metaDesc)
    metaDesc.length
    metaDesc[0]
    metaDesc[0].content
    alert(metaDesc[0])
    alert(metaDesc[0].tagName)
    var metaBaiduVerification = document.getElementsByName('baidu-site-verification')
    alert(metaBaiduVerification)
    alert(metaBaiduVerification[0])
    metaBaiduVerification[0].tagName

### DOM操作API

 [JavaScript DOM API](https://developer.mozilla.org/zh-CN/docs/Web/API)

 [http://krook.org/jsdom/](http://krook.org/jsdom/)


























